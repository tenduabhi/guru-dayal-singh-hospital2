<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guru Dayal Singh Hospital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gray-50 text-gray-800;
        }
        .container {
            @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
        }
        .btn-primary {
            @apply inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg shadow-sm text-white bg-gray-700 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-300;
        }
        .btn-secondary {
            @apply inline-flex items-center justify-center px-6 py-3 border border-gray-700 text-base font-medium rounded-lg text-gray-700 bg-white hover:bg-red-600 hover:text-white hover:border-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-300;
        }
        .section-heading {
            /* Reduced margin-bottom to minimum for super tight spacing */
            @apply text-3xl sm:text-4xl font-bold text-gray-800 text-center mb-0; 
        }
        .page-content {
            @apply container py-16;
        }
        #back-to-top-btn {
            @apply hidden fixed bottom-5 right-5 z-50 p-3 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-700 transition-opacity duration-300;
        }
        /* Styles for the calendar */
        .available-day {
            background-color: #dcfce7; /* Tailwind green-200 */
            color: #166534; /* Tailwind green-800 */
            font-weight: 600;
        }
        .unavailable-day {
            background-color: #fee2e2; /* Tailwind red-200 */
            color: #991b1b; /* Tailwind red-800 */
            cursor: not-allowed;
            opacity: 0.7;
        }
        .today {
            outline: 2px solid #3b82f6; /* Tailwind ring-2 ring-blue-500 */
            outline-offset: 1px;
        }
        /* Styles for the star rating */
        .star {
            cursor: pointer;
            color: #d1d5db; /* gray-300 */
            transition: color 0.2s ease-in-out;
        }
        .star.selected,
        .star.hovered {
            color: #f59e0b; /* amber-500 */
        }
        /* Styles for the Model of Care section */
        .care-point .know-more-arrow {
            transition: transform 0.3s ease-in-out;
        }
        .care-point:hover .know-more-arrow {
            transform: translateX(4px);
        }

        /* Styles for the Model of Care diagram (from previous snippet, adapted) */
        .diagram-wrapper-new { /* Renamed to avoid conflict with existing Tailwind container */
            position: relative;
            width: 100%;
            max-width: 700px;
            /* Adjusted padding-top to reduce overall height for tighter spacing */
            padding-top: 75%; /* Creates a 4:3 aspect ratio container (75% height of width) */
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            min-height: 300px; /* Kept a minimal height as a fallback */
        }
        /* Inner wrapper to correctly size the absolute children within the padding-top trick */
        .diagram-wrapper-new-inner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }


        .center-image-new {
            /* Changed to relative units (em) for better zoom scaling */
            width: 15em; 
            height: 15em;
            border-radius: 50%;
            overflow: hidden;
            position: absolute;
            z-index: 2;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #eee;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border: 4px solid #fff;
        }

        .center-image-new img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .nodes-container-new {
            position: absolute;
            width: 100%;
            height: 100%;
            /* Nodes will be dynamically positioned by JavaScript */
        }

        .node-new {
            /* Changed to relative units (em) for better zoom scaling */
            position: absolute;
            width: 13em;
            height: 13em;
            background-color: #e0f2f7;
            border: 1px solid #a7d9eb;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0.5em; /* Adjusted padding to em */
            box-sizing: border-box;
            font-size: 0.9em; /* Adjusted font size for nodes to em */
            color: #333;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 1;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .node-new:hover {
            transform: scale(1.05) translate(-50%, -50%);
            background-color: #d1edf2;
        }

        .node-new strong {
            margin-bottom: 0.3em; /* Adjusted margin to em */
            font-size: 1.1em;
            line-height: 1.3;
        }

        .know-more-new {
            display: flex;
            align-items: center;
            color: #c00;
            font-weight: bold;
            margin-top: 0.5em; /* Adjusted margin to em */
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .know-more-new:hover {
            color: #a00;
        }

        /* SVG for lines */
        .diagram-lines-new {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .model-care-heading-desktop {
            /* Adjusted top for a small gap from top node, also using em for scaling */
            position: absolute;
            top: -5.5em; /* Increased from -4em to provide more gap */
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            text-align: center;
            font-size: 1.8em; /* Adjusted font size to em */
            font-weight: 700;
            color: #374151;
            transition: color 0.3s duration-300;
            white-space: nowrap;
        }
        .model-care-heading-desktop:hover {
            color: #dc2626;
        }

        /* Chatbot specific styles */
        .chatbot-container {
            /* Positioned absolutely within the social-media-sidebar to align */
            position: absolute;
            bottom: 0; /* Align to the bottom of its parent */
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            padding-top: 0.5rem; /* Space between last social icon and AI button */
        }

        /* Updated chatbot button style to match social icons */
        .chatbot-button {
            @apply w-12 h-12 bg-gray-100 text-gray-700 rounded-lg shadow-lg flex items-center justify-center cursor-pointer hover:bg-gray-200 transition-colors duration-300;
        }

        /* Style for the "AI" text within the button */
        .chatbot-button-text {
            font-size: 1.25rem; /* text-xl */
            font-weight: bold; /* font-bold */
        }

        .chatbot-popup {
            position: fixed; /* Changed to fixed to correctly position relative to viewport */
            bottom: 6rem; /* Aligned with the chatbot button's bottom position + offset */
            right: calc(1.25rem + 3rem + 0.5rem); /* Right offset: right-5 + button width (12) + gap */
            width: 280px; /* Adjusted fixed width for the chat window */
            height: 380px; /* Adjusted fixed height for the chat window */
            background-color: white;
            border-radius: 0.75rem; /* rounded-lg */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform-origin: bottom right; /* For scaling animation */
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none; /* Allow clicks to pass through when hidden */
        }

        .chatbot-popup.show {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto; /* Enable clicks when shown */
        }

        .chatbot-header {
            @apply bg-blue-700 text-white p-3 rounded-t-lg flex justify-between items-center;
        }

        .chatbot-messages {
            @apply flex-1 p-3 overflow-y-auto text-sm;
        }

        .chatbot-input-area {
            @apply p-3 border-t border-gray-200 flex;
        }

        .chatbot-input {
            /* Styled to match header search bar */
            @apply flex-1 py-2 px-3 text-gray-700 bg-gray-100 border-2 border-gray-700 focus:outline-none focus:ring-red-500 focus:border-red-500 rounded-full transition-colors duration-300;
        }

        .chatbot-send-button {
            /* Styled to match search button in header */
            @apply ml-2 w-10 h-10 flex items-center justify-center text-white bg-red-500 hover:bg-red-600 rounded-full;
        }

        .user-message {
            @apply bg-blue-100 text-blue-900 p-2 rounded-lg mb-2 self-end max-w-[80%];
        }

        .bot-message {
            @apply bg-gray-100 text-gray-900 p-2 rounded-lg mb-2 self-start max-w-[80%];
        }
        /* Typing indicator animation */
        .animate-pulse {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Social Media Sidebar -->
    <!-- Wrapped social icons and chatbot button in a common container -->
    <div class="fixed top-1/2 -translate-y-1/2 right-0 flex flex-col items-center bg-transparent p-2 z-50">
        <div class="flex flex-col items-center space-y-2 bg-white p-2 rounded-l-lg shadow-lg relative"> <!-- Added relative here -->
            <a href="#emergency-details" class="service-link w-12 h-12 flex items-center justify-center bg-red-500 text-white rounded-lg hover:bg-red-700 transition-colors" aria-label="Emergency">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </a>
            <button id="share-toggle" class="w-12 h-12 flex items-center justify-center bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors" aria-label="Share">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.368a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
                </svg>
            </button>
            <!-- Chatbot button (AI) - moved to appear directly after share-toggle -->
            <button id="chatbot-toggle" class="w-12 h-12 flex items-center justify-center bg-gray-100 text-gray-700 rounded-lg shadow-lg cursor-pointer hover:bg-gray-200 transition-colors duration-300">
                <span class="chatbot-button-text">AI</span>
            </button>
            <div id="social-links" class="flex flex-col items-center space-y-2"> <!-- Removed hidden, added flex -->
                <a href="#" class="w-12 h-12 flex items-center justify-center bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200" aria-label="YouTube"><svg class="w-7 h-7" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 00 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path></svg></a>
                <a href="#" class="w-12 h-12 flex items-center justify-center bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200" aria-label="Facebook"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v7.028C18.343 21.128 22 16.991 22 12z"></path></svg></a>
                <a href="#" class="w-12 h-12 flex items-center justify-center bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200" aria-label="X/Twitter"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg></a>
                <a href="#" class="w-12 h-12 flex items-center justify-center bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200" aria-label="Instagram"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg></a>
            </div>
        </div>
        <!-- Chatbot popup is now sibling to the main sidebar div -->
        <div id="chatbot-popup" class="chatbot-popup">
            <div class="chatbot-header">
                <h3 class="font-semibold">Hospital Assistant</h3>
                <button id="chatbot-close" class="text-white hover:text-gray-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="chatbot-messages" class="chatbot-messages flex flex-col">
                <!-- Initial welcome message will be added by JavaScript -->
            </div>
            <div class="chatbot-input-area">
                <input type="text" id="chatbot-input" placeholder="Type your message..." class="chatbot-input">
                <button id="chatbot-send" class="chatbot-send-button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                </button>
            </div>
        </div>
    </div>

    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="container py-4 flex justify-between items-center">
            <a href="#home" class="flex items-center text-xl md:text-2xl font-bold text-gray-600 hover:text-red-600 transition-colors duration-300">
                <img src="https://i.ibb.co/TM7VZtr/logo.png" alt="Guru Dayal Singh Hospital Logo" class="h-10 md:h-12 w-auto mr-2 md:mr-3">
                <span>Guru Dayal Singh Hospital</span>
            </a>
            <nav class="hidden md:flex space-x-8">
                <a href="#home" class="text-gray-500 hover:text-red-600 font-medium transition-colors duration-200">Home</a>
                <a href="#doctors" class="text-gray-500 hover:text-red-600 font-medium transition-colors duration-200">Doctors</a>
                <a href="#services" class="text-gray-500 hover:text-red-600 font-medium transition-colors duration-200">Services</a>
                <a href="#lab-pharmacy" class="text-gray-500 hover:text-red-600 font-medium transition-colors duration-200">Lab & Pharmacy</a>
                <a href="#emergency" class="text-gray-500 hover:text-red-600 font-medium transition-colors duration-200">Emergency</a>
                <a href="#contact" class="text-gray-500 hover:text-red-600 font-medium transition-colors duration-200">Contact Us</a>
            </nav>
            <div class="flex items-center space-x-4">
                <a href="tel:+919939396778" class="hidden md:flex items-center text-gray-700 hover:text-red-600 font-semibold transition-colors duration-200"><svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>Call Reception</a>
                <a href="https://wa.me/919939396778" target="_blank" class="hidden md:flex text-gray-700 hover:text-red-600"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91c0 1.79.46 3.48 1.32 4.94L2 22l5.3-1.38c1.41.81 3.02 1.29 4.74 1.29h.01c5.46 0 9.9-4.45 9.9-9.91s-4.44-9.9-9.9-9.9zM16.9 14.89c-.27-.13-1.59-.78-1.84-.87-.25-.09-.43-.13-.62.13-.19.27-.7.87-.86 1.04-.16.17-.32.19-.59.06-.27-.13-1.14-.42-2.17-1.34-.81-.72-1.35-1.61-1.51-1.88-.16-.27-.01-.42.12-.55.12-.12.27-.31.4-.41.13-.1.17-.22.25-.37.08-.15.04-.27-.02-.4l-.59-1.42c-.24-.57-.48-.49-.66-.5-.17-.01-.36-.01-.54-.01-.18 0-.47.07-.72.34-.25.27-.95.93-.95 2.26s.97 2.62 1.1 2.8c.13.17 1.91 2.92 4.63 4.09 2.72 1.17 2.72.78 3.22.73.49-.05 1.59-.65 1.81-1.29.23-.64.23-1.18.16-1.29c-.07-.11-.25-.17-.52-.3z" /></svg></a>
                <button id="mobile-menu-toggle" class="md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-500"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg py-4 px-6">
            <nav class="flex flex-col space-y-4">
                <a href="#home" class="text-gray-800 hover:text-red-600 font-medium">Home</a>
                <a href="#doctors" class="text-gray-800 hover:text-red-600 font-medium">Doctors</a>
                <a href="#services" class="text-gray-800 hover:text-red-600 font-medium">Services</a>
                <a href="#lab-pharmacy" class="text-gray-800 hover:text-red-600 font-medium">Lab & Pharmacy</a>
                <a href="#emergency" class="text-gray-800 hover:text-red-600 font-medium">Emergency</a>
                <a href="#contact" class="text-gray-800 hover:text-red-600 font-medium">Contact Us</a>
                <a href="tel:+919939396778" class="text-gray-700 hover:text-red-600 font-semibold py-2">Call Reception</a>
                <a href="https://wa.me/919939396778" target="_blank" class="text-gray-700 hover:text-red-600 font-semibold py-2 inline-flex items-center"><svg class="w-6 h-6 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91c0 1.79.46 3.48 1.32 4.94L2 22l5.3-1.38c1.41.81 3.02 1.29 4.74 1.29h.01c5.46 0 9.9-4.45 9.9-9.91s-4.44-9.9-9.9-9.9zM16.9 14.89c-.27-.13-1.59-.78-1.84-.87-.25-.09-.43-.13-.62.13-.19.27-.7.87-.86 1.04-.16.17-.32.19-.59.06-.27-.13-1.14-.42-2.17-1.34-.81-.72-1.35-1.61-1.51-1.88-.16-.27-.01-.42.12-.55.12-.12.27-.31.4-.41.13-.1.17-.22.25-.37.08-.15.04-.27-.02-.4l-.59-1.42c-.24-.57-.48-.49-.66-.5-.17-.01-.36-.01-.54-.01-.18 0-.47.07-.72.34-.25.27-.95.93-.95 2.26s.97 2.62 1.1 2.8c.13.17 1.91 2.92 4.63 4.09 2.72 1.17 2.72.78 3.22.73.49-.05 1.59-.65 1.81-1.29.23-.64.23-1.18.16-1.29c-.07-.11-.25-.17-.52-.3z" /></svg></a>
            </nav>
        </div>
    </header>

    <main>
        <section id="home" class="relative bg-gradient-to-r from-gray-100 to-red-100 pb-20 lg:pb-32 overflow-hidden">
            <div class="absolute inset-0 bg-cover bg-center opacity-30" style="background-image: url('https://picsum.photos/seed/hospitalhero/1920/1080');"></div>
            <div class="container relative z-10 text-center pt-20 lg:pt-32">
                <h1 class="group text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight mb-6">
                    <span class="text-gray-600 group-hover:text-red-600 transition-colors duration-300">Your Health, Our Priority:</span><br class="hidden sm:inline"><span class="text-red-600 group-hover:text-gray-600 transition-colors duration-300">Exceptional Care, Every Time.</span>
                </h1>
                <!-- Removed mb-10 from this paragraph for tighter spacing -->
                <p class="text-lg sm:text-xl text-gray-700 max-w-3xl mx-auto mb-0">Providing world-class healthcare with compassion and advanced medical expertise.</p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="#appointment-section" class="btn-primary">Book an Appointment</a>
                    <a href="#emergency-details" class="service-link btn-secondary">Emergency Services</a>
                </div>
            </div>
        </section>

        <!-- Search Bar Section: Further reduced inner padding for tighter layout -->
        <section class="relative z-20 pt-0"> 
            <div class="container">
                <!-- Reduced padding of the white container from p-6 to p-3 -->
                <div class="bg-white rounded-lg shadow-lg p-3 max-w-3xl mx-auto">
                    <div class="relative">
                        <!-- Updated border color to gray-700 for idle state -->
                        <input id="search-input" type="text" placeholder="Search for Doctors and Specialities" class="w-full py-3 pl-4 pr-12 text-gray-700 bg-gray-100 border-2 border-gray-700 focus:outline-none focus:ring-red-500 focus:border-red-500 rounded-full transition-colors duration-300">
                        <button id="search-button" class="absolute inset-y-0 right-0 flex items-center justify-center w-12 h-full text-white bg-red-500 hover:bg-red-600 rounded-full">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </button>
                    </div>
                    <!-- Reduced margin-top for category links from mt-4 to mt-2 -->
                    <div class="flex flex-wrap justify-center gap-x-4 gap-y-2 mt-2">
                        <a href="#consultation-details" class="service-link text-sm text-gray-600 hover:text-red-600 font-medium transition-colors">Consultation</a>
                        <a href="#diagnostics-details" class="service-link text-sm text-gray-600 hover:text-red-600 font-medium transition-colors">Lab & Reports</a>
                        <a href="#surgery-details" class="service-link text-sm text-gray-600 hover:text-red-600 font-medium transition-colors">Medicine</a>
                        <a href="#surgery-details" class="service-link text-sm text-gray-600 hover:text-red-600 font-medium transition-colors">Surgery</a>
                        <!-- Linked "Women Check Up" to Dr. Swati Kumari's profile -->
                        <a href="#dr-swati-kumari-details" class="service-link text-sm text-gray-600 hover:text-red-600 font-medium transition-colors">Women Check Up</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Model of Care Section: Adjusted section and inner div margins/paddings for super tight spacing -->
        <section id="model-of-care" class="pt-0 pb-0 bg-white -mt-16"> 
            <div class="container">
                <!-- Removed any margin-top on this inner div to pull content up -->
                <div class=""> 
                    <!-- Desktop Layout (Dynamic Circular Diagram) -->
                    <div class="hidden lg:block">
                        <div class="diagram-wrapper-new">
                            <div class="diagram-wrapper-new-inner">
                                <h2 class="model-care-heading-desktop">Guru Dayal Singh Model of Care</h2>
                                <div class="center-image-new">
                                    <img src="https://placehold.co/200x200/cccccc/333333?text=Hospital+Team" alt="Surgical Team">
                                </div>
                                <div class="nodes-container-new">
                                    <!-- Nodes will be dynamically added by JavaScript -->
                                </div>
                                <svg class="diagram-lines-new"></svg>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile Layout (Existing Static Layout) -->
                    <div class="lg:hidden flex flex-col items-center">
                        <h2 class="section-heading">Guru Dayal Singh Model of Care</h2> <!-- Kept for mobile, already mb-0 -->
                        <img src="https://images.unsplash.com/photo-1579684385127-1ef15d508118?q=80&w=400&auto=format&fit=crop&crop=center" alt="Surgeons in operating room" class="w-48 h-48 rounded-full object-cover shadow-xl border-4 border-white">
                        <!-- Reduced vertical space between mobile care points from space-y-8 to space-y-4 -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4 text-center">
                            <div class="care-point">
                                <h3 class="font-semibold text-gray-700 hover:text-red-600 transition-colors">Exceptional clinical talent</h3>
                                <a href="#clinical-talent-details" class="text-sm text-red-500 hover:text-red-700 font-semibold group" data-back-to-scroll="true">Know More <span class="inline-block know-more-arrow">&gt;</span></a>
                            </div>
                            <div class="care-point">
                                <h3 class="font-semibold text-gray-700 hover:text-red-600 transition-colors">World-class infrastructure</h3>
                                <a href="#infrastructure-details" class="text-sm text-red-500 hover:text-red-700 font-semibold group" data-back-to-scroll="true">Know More <span class="inline-block know-more-arrow">&gt;</span></a>
                            </div>
                            <div class="care-point">
                                <h3 class="font-semibold text-gray-700 hover:text-red-600 transition-colors">Latest high-end technology</h3>
                                <a href="#technology-details" class="text-sm text-red-500 hover:text-red-700 font-semibold group" data-back-to-scroll="true">Know More <span class="inline-block know-more-arrow">&gt;</span></a>
                            </div>
                            <div class="care-point">
                                <h3 class="font-semibold text-gray-700 hover:text-red-600 transition-colors">Caring systems and processes</h3>
                                <a href="#systems-processes-details" class="text-sm text-red-500 hover:text-red-700 font-semibold group" data-back-to-scroll="true">Know More <span class="inline-block know-more-arrow">&gt;</span></a>
                            </div>
                             <div class="care-point sm:col-span-2">
                                <h3 class="font-semibold text-gray-700 hover:text-red-600 transition-colors">Trust-based compassionate care</h3>
                                <a href="#compassionate-care-details" class="text-sm text-red-500 hover:text-red-700 font-semibold group" data-back-to-scroll="true">Know More <span class="inline-block know-more-arrow">&gt;</span></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <!-- Our Core Services Section: Adjusted section padding and service card padding -->
        <section id="services" class="pt-0 pb-4 bg-white scroll-mt-20 -mt-16"> 
            <div class="container">
                <!-- Heading margin is already mb-0 from previous step -->
                <h2 class="section-heading hover:text-red-600 transition-colors duration-300">Our Core Services</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Reduced padding on service cards from p-6 to p-4 -->
                    <a href="#consultation-details" class="service-link block bg-gray-50 p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 text-center">
                        <img src="https://images.unsplash.com/photo-1559839734-2b71ea197ec2?q=80&w=2070&auto=format&fit=crop" alt="Doctor Consultation" class="w-20 h-20 mx-auto mb-4 rounded-full object-cover">
                        <h3 class="text-xl font-semibold text-gray-700 hover:text-red-600 transition-colors duration-300 mb-2">Expert Consultation</h3>
                        <p class="text-gray-600">Connect with leading specialists for personalized care and diagnosis.</p>
                    </a>
                    <a href="#diagnostics-details" class="service-link block bg-gray-50 p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 text-center">
                        <img src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?q=80&w=2070&auto=format&fit=crop" alt="Lab Tests" class="w-20 h-20 mx-auto mb-4 rounded-full object-cover">
                        <h3 class="text-xl font-semibold text-gray-700 hover:text-red-600 transition-colors duration-300 mb-2">Advanced Diagnostics</h3>
                        <p class="text-gray-600">State-of-the-art lab and imaging facilities for accurate results.</p>
                    </a>
                    <a href="#surgery-details" class="service-link block bg-gray-50 p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 text-center">
                        <img src="https://images.unsplash.com/photo-1551501419-cb31cdd5e236?q=80&w=2070&auto=format&fit=crop" alt="Surgery" class="w-20 h-20 mx-auto mb-4 rounded-full object-cover">
                        <h3 class="text-xl font-semibold text-gray-700 hover:text-red-600 transition-colors duration-300 mb-2">Surgical Excellence</h3>
                        <p class="text-gray-600">Minimally invasive and complex surgeries performed by skilled surgeons.</p>
                    </a>
                    <a href="#emergency-details" class="service-link block bg-gray-50 p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 text-center">
                        <img src="https://images.unsplash.com/photo-1605289982774-9a6fef564df8?q=80&w=1935&auto=format&fit=crop" alt="Emergency Care" class="w-20 h-20 mx-auto mb-4 rounded-full object-cover">
                        <h3 class="text-xl font-semibold text-gray-700 hover:text-red-600 transition-colors duration-300 mb-2">24/7 Emergency Care</h3>
                        <p class="text-gray-600">Immediate and critical medical attention available round the clock.</p>
                    </a>
                </div>
            </div>
        </section>

        <section id="doctors" class="py-16 bg-gray-100 scroll-mt-20">
            <div class="container">
                <h2 class="section-heading hover:text-red-600 transition-colors duration-300">Our Esteemed Doctors</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 text-center">
                        <img src="https://picsum.photos/seed/doctor1/200/200" alt="Dr. Anya Sharma" class="w-32 h-32 mx-auto mb-4 rounded-full object-cover shadow-md">
                        <h3 class="text-xl font-semibold text-gray-700 hover:text-red-600 transition-colors duration-300 mb-1">Dr. Anya Sharma</h3>
                        <p class="text-gray-600 hover:text-red-600 transition-colors duration-300 text-sm mb-3">
                            <!-- Changed specialty text color to red -->
                            <span class="text-red-600">Cardiologist</span>
                        </p>
                        <p class="text-gray-600 text-sm mb-4">15+ Years Experience | Specializes in Interventional Cardiology</p>
                        <!-- Added text-red-600 and font-bold to View Profile link -->
                        <a href="#dr-anya-sharma-details" class="service-link btn-secondary text-sm py-2 px-4 text-red-600 font-bold">View Profile</a>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 text-center">
                        <img src="https://picsum.photos/seed/doctor2/200/200" alt="Dr. Rohan Mehta" class="w-32 h-32 mx-auto mb-4 rounded-full object-cover shadow-md">
                        <h3 class="text-xl font-semibold text-gray-700 hover:text-red-600 transition-colors duration-300 mb-1">Dr. Rohan Mehta</h3>
                        <p class="text-gray-600 hover:text-red-600 transition-colors duration-300 text-sm mb-3">
                            <!-- Changed specialty text color to red -->
                            <span class="text-red-600">Orthopedic Surgeon</span>
                        </p>
                        <p class="text-gray-600 text-sm mb-4">12+ Years Experience | Expertise in Joint Replacement</p>
                        <!-- Added text-red-600 and font-bold to View Profile link -->
                        <a href="#dr-rohan-mehta-details" class="service-link btn-secondary text-sm py-2 px-4 text-red-600 font-bold">View Profile</a>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 text-center">
                        <img src="https://i.ibb.co/1YSj5mh/dr-swati.jpg" alt="Dr. Swati Kumari" class="w-32 h-32 mx-auto mb-4 rounded-full object-cover shadow-md">
                        <h3 class="text-xl font-semibold text-gray-700 hover:text-red-600 transition-colors duration-300 mb-1">Dr. Swati Kumari</h3>
                        <p class="text-gray-600 hover:text-red-600 transition-colors duration-300 text-sm mb-3">
                            <!-- Changed specialty text color to red -->
                            <span class="text-red-600">General Physician</span>
                        </p>
                        <p class="text-gray-600 text-sm mb-4">Specializes in Women's Health & Check-ups</p>
                        <!-- Added text-red-600 and font-bold to View Profile link -->
                        <a href="#dr-swati-kumari-details" class="service-link btn-secondary text-sm py-2 px-4 text-red-600 font-bold">View Profile</a>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="appointment-section" class="py-16 bg-gray-100 scroll-mt-20">
            <div class="container">
                <div class="max-w-md mx-auto bg-white p-8 rounded-lg shadow-xl">
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Book an Appointment</h2>
                    <form id="appointment-form">
                        <div class="space-y-4">
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="name" name="name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                                <input type="tel" id="phone" name="phone" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="appointment-date" class="block text-sm font-medium text-gray-700">Preferred Date</label>
                                <input type="date" id="appointment-date" name="appointment-date" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">
                            </div>
                             <div>
                                <label for="appointment-time" class="block text-sm font-medium text-gray-700">Preferred Time</label>
                                <input type="time" id="appointment-time" name="appointment-time" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">
                            </div>
                            <div>
                                <label for="doctor-select" class="block text-sm font-medium text-gray-700">Preferred Doctor/Speciality</label>
                                <select id="doctor-select" name="doctor-select" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">
                                    <option value="">Any Doctor/Speciality</option>
                                    <option value="Dr. Anya Sharma (Cardiologist)">Dr. Anya Sharma (Cardiologist)</option>
                                    <option value="Dr. Rohan Mehta (Orthopedic Surgeon)">Dr. Rohan Mehta (Orthopedic Surgeon)</option>
                                    <option value="Dr. Swati Kumari (General Physician)">Dr. Swati Kumari (General Physician)</option>
                                    <option value="Expert Consultation">Expert Consultation</option>
                                    <option value="Advanced Diagnostics">Advanced Diagnostics</option>
                                    <option value="Surgical Excellence">Surgical Excellence</option>
                                    <option value="24/7 Emergency Care">24/7 Emergency Care</option>
                                </select>
                            </div>
                            <div>
                                <label for="reason" class="block text-sm font-medium text-gray-700">Reason to Visit</label>
                                <textarea id="reason" name="reason" rows="3" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm"></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end">
                            <button type="submit" class="btn-primary w-full">Submit Appointment Request</button>
                        </div>
                    </form>
                    <!-- Confirmation Message Area -->
                    <div id="appointment-confirmation-message" class="hidden mt-6 text-center p-4 bg-green-100 text-green-800 rounded-md shadow-sm">
                        <!-- Confirmation details will be inserted here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Feedback Section -->
        <section id="feedback" class="py-16 bg-gray-50 scroll-mt-20">
            <div class="container">
                <h2 class="section-heading hover:text-red-600 transition-colors duration-300">Share Your Experience</h2>
                <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-xl">
                    <form id="feedback-form">
                        <div class="space-y-6">
                            <div>
                                <label for="patient-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="patient-name" name="patient-name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm" placeholder="e.g., John Doe">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Your Rating</label>
                                <div id="star-rating" class="flex items-center space-x-1">
                                    <!-- Stars are generated by JavaScript -->
                                </div>
                                <input type="hidden" id="rating-value" name="rating-value">
                                <p id="rating-error" class="text-red-500 text-sm mt-1 hidden">Please select a rating.</p>
                            </div>
                            <div>
                                <label for="feedback-message" class="block text-sm font-medium text-gray-700">Feedback</label>
                                <textarea id="feedback-message" name="feedback-message" rows="4" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm" placeholder="Tell us about your experience..."></textarea>
                            </div>
                        </div>
                        <div class="mt-8 flex justify-end">
                            <button type="submit" class="btn-primary w-full">Submit Feedback</button>
                        </div>
                    </form>
                    <div id="feedback-success-message" class="hidden mt-6 text-center p-4 bg-green-100 text-green-800 rounded-md shadow-sm">
                        Thank you for your valuable feedback!
                    </div>
                </div>
                
                <!-- New section to display feedback -->
                <div class="mt-12">
                    <h2 class="section-heading">What Our Patients Say</h2>
                    <div id="feedback-display-area" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Feedback cards will be dynamically inserted here -->
                        <!-- Example Feedback Card (hidden by default) -->
                        <div class="feedback-card hidden bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center mb-4">
                                <span class="feedback-stars text-amber-500 text-xl mr-2">${'⭐'.repeat(5)}</span>
                                <h3 class="feedback-name font-semibold text-gray-800">John Doe</h3>
                            </div>
                            <p class="feedback-message text-gray-700 text-sm">Great service!</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Contact Us Section -->
        <section id="contact" class="py-16 bg-white scroll-mt-20">
            <div class="container">
                <h2 class="section-heading hover:text-red-600 transition-colors duration-300">Contact Us</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div class="bg-gray-50 p-8 rounded-lg shadow-md">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-4">Get In Touch</h3>
                        <p class="text-gray-600 mb-6">We are here for you 24/7. Reach out to us through any of the following channels.</p>
                        
                        <div class="space-y-4">
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-red-600 mr-4 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                <div>
                                    <h4 class="font-semibold text-gray-700">Address</h4>
                                    <p class="text-gray-600">Guru Dayal Singh Hospital</p>
                                    <p class="text-gray-600">NH30, Near Amity School, Sonbarsha, Bihar, 802125</p>
                                </div>
                            </div>
                             <div class="flex items-start">
                                <svg class="w-6 h-6 text-red-600 mr-4 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                                <div>
                                    <h4 class="font-semibold text-gray-700">Phone</h4>
                                    <a href="tel:+919939396778" class="text-red-600 hover:underline">+91 9939396778</a>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <svg class="w-6 h-6 text-red-600 mr-4 mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91c0 1.79.46 3.48 1.32 4.94L2 22l5.3-1.38c1.41.81 3.02 1.29 4.74 1.29h.01c5.46 0 9.9-4.45 9.9-9.91s-4.44-9.9-9.9-9.9zM16.9 14.89c-.27-.13-1.59-.78-1.84-.87-.25-.09-.43-.13-.62.13-.19.27-.7.87-.86 1.04-.16.17-.32.19-.59.06-.27-.13-1.14-.42-2.17-1.34-.81-.72-1.35-1.61-1.51-1.88-.16-.27-.01-.42.12-.55.12-.12.27-.31.4-.41.13-.1.17-.22.25-.37.08-.15.04-.27-.02-.4l-.59-1.42c-.24-.57-.48-.49-.66-.5-.17-.01-.36-.01-.54-.01-.18 0-.47.07-.72.34-.25.27-.95.93-.95 2.26s.97 2.62 1.1 2.8c.13.17 1.91 2.92 4.63 4.09 2.72 1.17 2.72.78 3.22.73.49-.05 1.59-.65 1.81-1.29.23-.64.23-1.18.16-1.29c-.07-.11-.25-.17-.52-.3z" /></svg>
                                <div>
                                    <h4 class="font-semibold text-gray-700">WhatsApp</h4>
                                    <a href="https://wa.me/919939396778" target="_blank" class="text-red-600 hover:underline">Chat with us</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                         <iframe class="w-full h-full rounded-lg shadow-md" style="min-height: 400px;" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3615.111956165445!2d84.7770878150064!3d25.03035308397395!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x399281a4921f9873%3A0x6b5c464225732b17!2sGuru%20Dayal%20Singh%20Hospital!5e0!3m2!1sen!2sin!4v1687010472488!5m2!1sen!2sin" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-gray-800 text-white">
        <div class="container py-4 text-center">
             <p>&copy; 2024 Guru Dayal Singh Hospital. All Rights Reserved.</p>
        </div>
    </footer>

    <div id="page-details" class="hidden">
        <!-- New detail pages for Model of Care -->
        <div id="clinical-talent-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8" data-back-to-scroll="true">&larr; Back</button>
            <h2 class="section-heading text-left">Unrivaled Expertise: Our Exceptional Clinical Talent</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <img src="https://placehold.co/400x250/d1e7dd/1a531f?text=Exceptional+Team" alt="Exceptional Team" class="w-full h-auto object-cover rounded-lg mb-6">
                <p>At Guru Dayal Singh Hospital, the cornerstone of our superior patient care is our team of exceptional clinical talent. We pride ourselves on a diverse roster of highly skilled and experienced medical professionals, from renowned surgeons and specialists to compassionate nurses and dedicated support staff. Each member of our team is hand-picked not only for their extensive qualifications and expertise but also for their unwavering commitment to patient well-being and continuous professional development. They are at the forefront of medical advancements, consistently integrating the latest research and best practices into their daily routines. Our clinicians collaborate seamlessly across departments, ensuring a holistic and integrated approach to diagnosis and treatment. This collective brilliance ensures that every patient receives personalized, cutting-edge care designed for optimal outcomes and a comfortable recovery journey.</p>
            </div>
        </div>

        <div id="infrastructure-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8" data-back-to-scroll="true">&larr; Back</button>
            <h2 class="section-heading text-left">State-of-the-Art Foundations: World-Class Infrastructure</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <img src="https://placehold.co/400x250/e0f2f7/2b6777?text=Modern+Hospital+Interior" alt="Modern Hospital Interior" class="w-full h-auto object-cover rounded-lg mb-6">
                <p>Guru Dayal Singh Hospital is built upon a foundation of world-class infrastructure, meticulously designed to support advanced medical care and ensure patient comfort and safety. Our facilities feature modern, spacious patient rooms equipped with the latest amenities, state-of-the-art operating theatres with integrated imaging systems, and specialized units for intensive care, neonatal care, and recovery. We have invested in smart building technologies for optimal air quality and infection control, and our accessible layouts cater to the needs of all patients. From a welcoming lobby to serene healing gardens, every aspect of our infrastructure is planned to create an environment conducive to healing. This robust physical framework empowers our medical teams to deliver precision care efficiently, providing a safe, clean, and technologically advanced setting for every treatment journey.</p>
            </div>
        </div>

        <div id="technology-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8" data-back-to-scroll="true">&larr; Back</button>
            <h2 class="section-heading text-left">Precision and Progress: Our Latest High-End Technology</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <img src="https://placehold.co/400x250/fcefdc/8a531e?text=High-Tech+Medical+Equipment" alt="High-Tech Medical Equipment" class="w-full h-auto object-cover rounded-lg mb-6">
                <p>Staying at the vanguard of medical innovation, Guru Dayal Singh Hospital is equipped with the latest high-end technology, ensuring the most accurate diagnostics, effective treatments, and safest procedures. Our commitment to technological excellence means we continuously upgrade our systems, from advanced diagnostic imaging (like 3T MRI, multi-slice CT, and 4D ultrasound) to sophisticated surgical robotics and minimally invasive tools. These technologies enhance precision, reduce recovery times, and improve patient outcomes significantly. We utilize integrated electronic health records for seamless information flow and employ cutting-edge laboratory automation for rapid and reliable test results. This dedication to technological superiority provides our clinicians with unparalleled capabilities, allowing them to perform intricate procedures and deliver targeted therapies with unprecedented accuracy and safety.</p>
            </div>
        </div>

        <div id="systems-processes-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8" data-back-to-scroll="true">&larr; Back</button>
            <h2 class="section-heading text-left">Seamless Care: Optimized Systems and Processes</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <img src="https://placehold.co/400x250/f3e8ff/5a189a?text=Patient+Flow/Process" alt="Patient Flow/Process" class="w-full h-auto object-cover rounded-lg mb-6">
                <p>Our commitment to your well-being extends beyond medical treatment into our meticulously designed caring systems and processes. Guru Dayal Singh Hospital operates on a foundation of streamlined workflows and patient-centric protocols, ensuring that every step of your healthcare journey is efficient, transparent, and supportive. From simplified admission and discharge procedures to integrated care coordination among specialists, we strive to minimize waiting times and maximize positive interactions. Our advanced appointment scheduling system, clear communication channels, and robust patient feedback mechanisms are all in place to ensure your voice is heard and your needs are met promptly. We continually review and refine our processes to enhance safety, improve communication, and deliver a consistently high standard of care that focuses on your comfort and peace of mind.</p>
            </div>
        </div>

        <div id="compassionate-care-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8" data-back-to-scroll="true">&larr; Back</button>
            <h2 class="section-heading text-left">Healing with Heart: Trust-Based Compassionate Care</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <img src="https://placehold.co/400x250/ffebee/9b1c1c?text=Compassionate+Care" alt="Compassionate Care" class="w-full h-auto object-cover rounded-lg mb-6">
                <p>At Guru Dayal Singh Hospital, we believe that true healing encompasses not just physical treatment but also emotional and psychological support, anchored in trust-based compassionate care. Our approach is founded on empathy, respect, and open communication. We foster an environment where patients and their families feel heard, understood, and genuinely cared for. Our medical professionals are trained to deliver care with kindness and dignity, recognizing the unique emotional needs of each individual. Building trust is paramount, achieved through clear explanations, honest dialogue, and consistent support throughout the recovery process. This human-centered philosophy ensures that while we heal bodies, we also nurture spirits, making your journey towards health as comforting and reassuring as possible.</p>
            </div>
        </div>
        <!-- End new detail pages -->

        <div id="consultation-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8">&larr; Back to Home</button>
            <h2 class="section-heading text-left">Expert Consultation</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <p>Receiving an accurate diagnosis is the most critical first step towards your recovery. At Guru Dayal Singh Hospital, our Expert Consultation service connects you with some of the most respected specialists in their fields. We believe that quality healthcare begins with a thorough understanding of your unique health situation, which is why we've assembled a team of experienced and compassionate doctors who are dedicated to listening to your concerns and providing personalized care.</p>
                <p>Whether you're dealing with a complex health issue or seeking a second opinion, our experts are here to help. We offer consultations across a wide range of specialties.</p>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li>Cardiology and Heart Health</li>
                    <li>Oncology (Cancer Care)</li>
                    <li>Neurology and Neurosurgery</li>
                    <li>Orthopedics and Joint Replacement</li>
                    <li>Gastroenterology and Digestive Health</li>
                    <li>Pediatrics and Child Care</li>
                    <li>Dermatology (Skin Care)</li>
                </ul>
                <p>Our goal is to empower you with knowledge and confidence, ensuring you are fully informed about your health and treatment options. Trust our experts to provide you with the clarity and direction you need on your journey to better health.</p>
            </div>
        </div>
        <div id="diagnostics-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8">&larr; Back to Home</button>
            <h2 class="section-heading text-left">Advanced Diagnostics</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <p>Accurate and timely diagnosis is the foundation of effective medical treatment. Our Advanced Diagnostics center at Guru Dayal Singh Hospital is equipped with the latest, state-of-the-art technology to provide precise and reliable results. We understand that waiting for test results can be stressful, which is why our dedicated team works efficiently to ensure you receive your reports as quickly as possible.</p>
                <p>Our facility offers a comprehensive range of diagnostic services, including:</p>
                 <ul class="list-disc list-inside space-y-2 pl-4">
                    <li>High-Resolution MRI (Magnetic Resonance Imaging)</li>
                    <li>Multi-Slice CT Scans (Computed Tomography)</li>
                    <li>Digital X-Ray and Fluoroscopy</li>
                    <li>4D Ultrasound and Echocardiography</li>
                    <li>Complete Pathology and Lab Services</li>
                    <li>Endoscopy and Colonoscopy</li>
                </ul>
                <p>Every test is conducted in a safe and comfortable environment by our highly trained staff who prioritize your care and comfort. We adhere to the strictest quality control standards to ensure that you and your doctor can trust the results.</p>
            </div>
        </div>
        <div id="surgery-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8">&larr; Back to Home</button>
            <h2 class="section-heading text-left">Surgical Excellence</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <p>When surgery is necessary, you want a team that combines skill, experience, and the latest technology. At Guru Dayal Singh Hospital, our Department of Surgical Excellence is home to some of the nation's foremost surgeons, who are leaders in their respective fields. Our team is proficient in a wide spectrum of procedures.</p>
                <p>Our key surgical offerings include:</p>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li>C-section (Caesarean Delivery)</li>
                    <li>Gallbladder Stone Removal</li>
                    <li>Laser-Guided Surgery</li>
                    <li>Kidney Stone Treatment</li>
                    <li>General Surgery</li>
                    <li>Minimally Invasive Laparoscopic Surgery</li>
                    <li>Robotic-Assisted Surgery</li>
                </ul>
                <p>Post-surgery, our dedicated nursing staff and rehabilitation specialists work together to manage your pain, support your recovery and help you return to your daily activities as quickly and safely as possible. Trust in our surgical expertise to deliver the best possible outcomes.</p>
            </div>
        </div>
        <div id="emergency-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8">&larr; Back to Home</button>
            <h2 class="section-heading text-left">24/7 Emergency Care</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <p>Medical emergencies can happen at any time, and when they do, every second counts. Guru Dayal Singh Hospital provides round-the-clock Emergency Care services to ensure that you and your family receive immediate medical attention when you need it most. Our Emergency Department is staffed by a dedicated team of highly skilled emergency physicians, nurses, and paramedics.</p>
                <p>Our emergency services feature:</p>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li>24x7 On-Site Staff and Specialists</li>
                    <li>Advanced ICU (Intensive Care Unit) & NICU (Neonatal ICU)</li>
                    <li>Ambulance Facility with Critical Care Support</li>
                    <li>Dedicated Stroke and Cardiac Emergency Protocols</li>
                    <li>Immediate Access to Diagnostic and Surgical Services</li>
                </ul>
                <p>We understand that an emergency can be a frightening experience, and our team is committed to providing not only expert medical care but also compassionate support to patients and their families during these stressful times. Your life is our priority.</p>
            </div>
        </div>
        <div id="dr-anya-sharma-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8">&larr; Back to Home</button>
            <h2 class="section-heading text-left">Dr. Anya Sharma - Cardiologist</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <p>Dr. Anya Sharma is a leading cardiologist at Guru Dayal Singh Hospital with over 15 years of experience in interventional cardiology. She is renowned for her expertise in treating complex heart conditions and is committed to providing the highest standard of cardiac care to her patients.</p>
                <p>Her focus is on minimally invasive procedures that promote faster recovery and better outcomes. She is dedicated to patient education and believes in empowering her patients to take an active role in their heart health.</p>
            </div>
        </div>
        <div id="dr-rohan-mehta-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8">&larr; Back to Home</button>
            <h2 class="section-heading text-left">Dr. Rohan Mehta - Orthopedic Surgeon</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <p>Dr. Rohan Mehta is a distinguished orthopedic surgeon specializing in joint replacement surgery. With 12 years of experience, he has helped countless patients regain mobility and live pain-free lives. He is known for his precision and use of advanced surgical techniques.</p>
                <p>Dr. Mehta provides comprehensive care for a wide range of orthopedic conditions, from sports injuries to degenerative joint diseases. He is available for consultations to discuss both surgical and non-surgical treatment options.</p>
            </div>
        </div>
        <div id="dr-swati-kumari-details" class="page-content hidden">
            <button class="back-button btn-secondary mb-8">&larr; Back to Home</button>
            <h2 class="section-heading text-left">Dr. Swati Kumari - General Physician</h2>
            <div class="text-lg text-gray-700 space-y-6">
                <p>Dr. Swati Kumari is a highly regarded General Physician practicing in Guru Dayal Singh Hospital India. With a strong foundation in general medicine, she provides comprehensive healthcare services for patients of all ages.</p>
                <p>Dr. Swati Kumari possesses a particular expertise in women's health check-ups and healthcare. She is dedicated to addressing the unique health concerns of women, offering thorough examinations, preventative screenings, and personalized advice to promote their well-being. Her expertise covers a wide range of women's health issues, ensuring comprehensive and sensitive care.</p>
                <p>Dr. Swati Kumari is available for consultations on Saturdays and Sundays. Please contact her clinic or the relevant healthcare facility at Guru Dayal singh Hospital to inquire about specific visiting hours and to schedule an appointment.</p>
            </div>
        </div>
    </div>
    
    <!-- Search Result Modal -->
    <div id="search-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 transition-opacity duration-300">
      <div class="relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
          <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
          </div>
          <h3 class="text-lg leading-6 font-medium text-gray-900 mt-4">Search Results</h3>
          <div class="mt-2 px-7 py-3">
            <p id="search-modal-message" class="text-sm text-gray-500">
              No results found.
            </p>
          </div>
          <div class="items-center px-4 py-3">
            <button id="search-modal-close" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Back to Top Button -->
    <button id="back-to-top-btn" aria-label="Go to top of page">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
    </button>
    
    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";


        document.addEventListener('DOMContentLoaded', async () => { // Made async to await Firebase init
            // Firebase Config and Init
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

            let app;
            let db;
            let auth;
            let userId = null;

            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);

                    // Sign in with custom token if available, otherwise anonymously
                    if (typeof __initial_auth_token !== 'undefined') {
                        await signInWithCustomToken(auth, __initial_auth_token);
                        console.log("Signed in with custom token.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously.");
                    }

                    // Set userId once auth state is confirmed
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            userId = user.uid;
                            console.log("Firebase User ID:", userId);
                            // Now that userId is available, you can safely set up Firestore listeners that depend on it
                            setupFeedbackListener(); // Call listener setup here
                        } else {
                            console.log("No user is signed in.");
                            userId = null;
                        }
                    });

                } else {
                    console.warn("Firebase config not found. Firebase services will not be available.");
                }
            } catch (error) {
                console.error("Error initializing Firebase:", error);
            }

            // --- Original Element Selectors ---
            const mobileMenuButton = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            const shareToggle = document.getElementById('share-toggle');
            const socialLinks = document.getElementById('social-links');
            const mainContent = document.querySelector('main');
            const pageDetailsContainer = document.getElementById('page-details');
            const appointmentForm = document.getElementById('appointment-form');
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const searchModal = document.getElementById('search-modal');
            const searchModalMessage = document.getElementById('search-modal-message');
            const searchModalClose = document.getElementById('search-modal-close');
            const backToTopBtn = document.getElementById('back-to-top-btn');
            
            // --- New Feedback Form Element Selectors ---
            const feedbackForm = document.getElementById('feedback-form');
            const starRatingContainer = document.getElementById('star-rating');
            const ratingValueInput = document.getElementById('rating-value');
            const ratingError = document.getElementById('rating-error');
            const feedbackSuccessMessage = document.getElementById('feedback-success-message');
            // Added new selector for feedback display area
            const feedbackDisplayArea = document.getElementById('feedback-display-area');
            const appointmentConfirmationMessage = document.getElementById('appointment-confirmation-message');

            // Chatbot elements
            const chatbotToggle = document.getElementById('chatbot-toggle');
            const chatbotPopup = document.getElementById('chatbot-popup');
            const chatbotClose = document.getElementById('chatbot-close');
            const chatbotMessages = document.getElementById('chatbot-messages');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotSend = document.getElementById('chatbot-send');


            // Array to store submitted feedback (in-memory, will be replaced by Firestore listener)
            let submittedFeedback = [];
            
            let calendarDate = new Date();
            let currentDoctorAvailability = [];
            let lastScrollPosition = 0; // Global variable to store scroll position

            // --- Helper Functions ---
            const showPage = (targetId) => {
                const targetPage = document.getElementById(targetId);
                if (targetPage && pageDetailsContainer.contains(targetPage)) {
                    mainContent.classList.add('hidden');
                    pageDetailsContainer.classList.remove('hidden');
                    document.querySelectorAll('.page-content').forEach(page => page.classList.add('hidden'));
                    targetPage.classList.remove('hidden');
                    window.scrollTo(0, 0);

                    if (targetId.startsWith('dr-')) {
                         if (targetId === 'dr-swati-kumari-details') {
                            setupCalendar(targetId, [0, 6]); // Sun, Sat
                        } else if (targetId === 'dr-anya-sharma-details') {
                            setupCalendar(targetId, [1, 3, 5]); // Mon, Wed, Fri
                        } else if (targetId === 'dr-rohan-mehta-details') {
                            setupCalendar(targetId, [2, 4]); // Tue, Thu
                        }
                    }
                }
            };

            const scrollToSection = (targetId) => {
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    pageDetailsContainer.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };

            const showModal = (message) => {
                searchModalMessage.innerHTML = message;
                searchModal.classList.remove('hidden');
            };

            const hideModal = () => {
                searchModal.classList.add('hidden');
            };
            
            // --- Back to Top Button Logic ---
            const toggleBackToTopButton = () => {
                if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
                    backToTopBtn.style.display = 'block';
                } else {
                    backToTopBtn.style.display = 'none';
                }
            };

            const scrollToTop = () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // --- Calendar Functionality ---
            const generateCalendar = (month, year, availableDays) => {
                const calendarDays = document.querySelector('.calendar-days');
                const monthYear = document.querySelector('.month-year');
                if (!calendarDays || !monthYear) return;

                calendarDays.innerHTML = '';
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startDayIndex = firstDay.getDay();

                monthYear.textContent = `${firstDay.toLocaleString('default', { month: 'long' })} ${year}`;
                
                for (let i = 0; i < startDayIndex; i++) {
                    calendarDays.innerHTML += '<div></div>';
                }
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.textContent = day;
                    const currentDate = new Date(year, month, day);
                    const dayOfWeek = currentDate.getDay();
                    
                    let classes = 'p-2 border rounded-md text-center';

                    if (availableDays.includes(dayOfWeek)) {
                        classes += ' available-day';
                    } else {
                        classes += ' unavailable-day';
                    }

                    const today = new Date();
                    if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                        classes += ' today';
                    }
                    
                    dayCell.className = classes;
                    calendarDays.appendChild(dayCell);
                }
            };

            const setupCalendar = (containerId, availableDays) => {
                currentDoctorAvailability = availableDays;
                const doctorProfile = document.getElementById(containerId);
                const calendarContainerDiv = doctorProfile.querySelector('.text-lg');
                
                if (calendarContainerDiv && !calendarContainerDiv.querySelector('.calendar-container-wrapper')) {
                    const calendarHtml = `
                        <div class="mt-12 calendar-container-wrapper">
                            <h3 class="text-2xl font-bold text-gray-800 text-center mb-6">Availability Calendar</h3>
                            <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md">
                                <div class="calendar-container">
                                    <div class="flex items-center justify-between mb-4">
                                        <button class="prev-month p-2 rounded-full hover:bg-gray-200 transition-colors">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                        </button>
                                        <h4 class="month-year text-xl font-semibold"></h4>
                                        <button class="next-month p-2 rounded-full hover:bg-gray-200 transition-colors">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-7 gap-2 text-center font-semibold text-gray-600 mb-2">
                                        <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                                    </div>
                                    <div class="calendar-days grid grid-cols-7 gap-2"></div>
                                    <div class="flex justify-center space-x-4 mt-4 text-sm">
                                        <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-green-200 mr-2"></span>Available</div>
                                        <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-red-200 mr-2"></span>Unavailable</div>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    calendarContainerDiv.insertAdjacentHTML('beforeend', calendarHtml);
                    
                    doctorProfile.querySelector('.prev-month').addEventListener('click', () => {
                        calendarDate.setMonth(calendarDate.getMonth() - 1);
                        generateCalendar(calendarDate.getMonth(), calendarDate.getFullYear(), currentDoctorAvailability);
                    });

                    doctorProfile.querySelector('.next-month').addEventListener('click', () => {
                        calendarDate.setMonth(calendarDate.getMonth() + 1);
                        generateCalendar(calendarDate.getMonth(), calendarDate.getFullYear(), currentDoctorAvailability);
                    });
                }
                calendarDate = new Date();
                generateCalendar(calendarDate.getMonth(), calendarDate.getFullYear(), availableDays);
            };

            // --- Search Functionality ---
            const searchTerms = [
                { keywords: ['consultation', 'consult'], targetId: 'consultation-details', type: 'page' },
                { keywords: ['diagnostics', 'lab', 'report', 'reports'], targetId: 'diagnostics-details', type: 'page' },
                { keywords: ['surgery', 'medicine'], targetId: 'surgery-details', type: 'page' },
                { keywords: ['emergency', '24/7'], targetId: 'emergency-details', type: 'page' },
                { keywords: ['doctor', 'doctors', 'anya', 'sharma', 'rohan', 'mehta', 'swati', 'kumari', 'cardiologist', 'orthopedic', 'physician'], targetId: 'doctors', type: 'scroll' },
                { keywords: ['dr swati', 'swati kumari'], targetId: 'dr-swati-kumari-details', type: 'page'},
                { keywords: ['dr anya', 'anya sharma'], targetId: 'dr-anya-sharma-details', type: 'page'},
                { keywords: ['dr rohan', 'rohan mehta'], targetId: 'dr-rohan-mehta-details', type: 'page'},
                { keywords: ['service', 'services', 'women', 'check', 'up'], targetId: 'services', type: 'scroll' },
                { keywords: ['appointment', 'book'], targetId: 'appointment-section', type: 'scroll'},
                { keywords: ['contact', 'address', 'phone', 'map'], targetId: 'contact', type: 'scroll'}
            ];

            const performSearch = () => {
                const query = searchInput.value.toLowerCase().trim();
                if (!query) return;

                let found = false;
                for (const term of searchTerms) {
                    if (term.keywords.some(keyword => query.includes(keyword))) {
                        if (term.type === 'page') {
                            showPage(term.targetId);
                        } else if (term.type === 'scroll') {
                            scrollToSection(term.targetId);
                        }
                        found = true;
                        break;
                    }
                }

                if (!found) {
                    showModal(`No results found for "<strong>${searchInput.value}</strong>".<br>Please try searching for services like 'Surgery', 'Emergency', a doctor's name, or 'Contact'.`);
                }
                searchInput.value = '';
            };

            // --- Star Rating Functionality ---
            if (starRatingContainer) {
                const stars = [];
                for (let i = 1; i <= 5; i++) {
                    const star = document.createElement('span');
                    star.classList.add('star');
                    star.dataset.value = i;
                    star.innerHTML = `<svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;
                    starRatingContainer.appendChild(star);
                    stars.push(star);
                }

                const setRating = (value) => {
                    stars.forEach(star => {
                        star.classList.toggle('selected', star.dataset.value <= value);
                        star.classList.remove('hovered');
                    });
                };

                stars.forEach(star => {
                    star.addEventListener('mouseover', () => {
                        const value = star.dataset.value;
                        stars.forEach(s => s.classList.toggle('hovered', s.dataset.value <= value));
                    });
                    
                    star.addEventListener('mouseout', () => {
                        stars.forEach(s => s.classList.remove('hovered'));
                    });
                    
                    star.addEventListener('click', () => {
                        const value = star.dataset.value;
                        ratingValueInput.value = value;
                        ratingError.classList.add('hidden');
                        setRating(value);
                    });
                });
            }
            
            // --- Event Listeners ---

            // Back to Top
            window.onscroll = () => toggleBackToTopButton();
            if(backToTopBtn) backToTopBtn.addEventListener('click', scrollToTop);

            // Mobile Menu
            if(mobileMenuButton) mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            
            // Share Toggle
            if(shareToggle) shareToggle.addEventListener('click', () => {
                socialLinks.classList.toggle('hidden');
                socialLinks.classList.toggle('flex');
            });
            
            // Unified Anchor Link Handler (for nav, service links, etc.)
            // Changed to event delegation to handle dynamically added elements (Model of Care)
            document.addEventListener('click', function (e) {
                let targetAnchor = e.target.closest('a[href^="#"]'); // Find the closest ancestor that is an anchor with href starting with #

                if (targetAnchor) {
                    e.preventDefault();
                    const targetId = targetAnchor.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);

                    if (targetElement && pageDetailsContainer.contains(targetElement)) {
                        // If it's a link to a detail page, save current scroll position
                        lastScrollPosition = window.scrollY || document.documentElement.scrollTop;
                        showPage(targetId);
                    } else if (targetElement) {
                        // It's a link to a section on the main page
                        scrollToSection(targetId);
                    }
                }
            });

            // Back Buttons in Detail Pages (modified to use lastScrollPosition)
            document.querySelectorAll('.back-button').forEach(button => {
                button.addEventListener('click', () => {
                    pageDetailsContainer.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    // Scroll back to the saved position, only if it's a "back-to-scroll" button
                    if (button.dataset.backToScroll) {
                        window.scrollTo({ top: lastScrollPosition, behavior: 'smooth' });
                    } else {
                        // Default behavior for other back buttons (e.g., Doctors, Home)
                        scrollToSection('doctors'); // Or 'home', depending on desired default
                    }
                });
            });
            
            // Appointment Form
            if(appointmentForm) {
                appointmentForm.addEventListener('submit', async (event) => { // Made async for Firestore
                    event.preventDefault();
                    
                    // Hide any previous confirmation message
                    appointmentConfirmationMessage.classList.add('hidden');

                    const name = document.getElementById('name').value;
                    const phone = document.getElementById('phone').value;
                    const appointmentDate = document.getElementById('appointment-date').value;
                    const appointmentTime = document.getElementById('appointment-time').value;
                    const doctor = document.getElementById('doctor-select').value;
                    const reason = document.getElementById('reason').value;

                    const appointmentData = {
                        name,
                        phone,
                        appointmentDate,
                        appointmentTime,
                        doctor,
                        reason,
                        timestamp: new Date() // Add a timestamp for ordering
                    };

                    try {
                        if (db && userId) {
                            // Save to Firestore
                            const appointmentsColRef = collection(db, `artifacts/${appId}/public/data/appointments`);
                            await addDoc(appointmentsColRef, appointmentData);
                            console.log("Appointment saved to Firestore:", appointmentData);

                            // Display on-page confirmation
                            appointmentConfirmationMessage.innerHTML = `
                                <h3 class="text-xl font-bold mb-2">Appointment Confirmed!</h3>
                                <p>Thank you, <strong>${name}</strong>.</p>
                                <p>Your appointment is scheduled for:</p>
                                <p class="font-semibold">${new Date(appointmentDate).toDateString()} at ${appointmentTime}</p>
                                <p>With: <strong>${doctor || 'Any Doctor/Speciality'}</strong></p>
                                <p class="mt-2">We look forward to seeing you.</p>
                            `;
                            appointmentConfirmationMessage.classList.remove('hidden');

                            appointmentForm.reset();
                        } else {
                            // Fallback if Firebase not initialized or no user ID (shouldn't happen with authStateChanged)
                            console.warn("Firebase or User ID not available. Cannot save appointment to Firestore.");
                            // Keep WhatsApp fallback if Firestore is not available
                            const message = `New Appointment Request:\n\nName: ${name}\nPhone: ${phone}\nDate: ${appointmentDate}\nTime: ${appointmentTime}\nDoctor: ${doctor}\nReason: ${reason}`;
                            const whatsappUrl = `https://wa.me/919939396778?text=${encodeURIComponent(message)}`;
                            window.open(whatsappUrl, '_blank');
                            appointmentConfirmationMessage.innerHTML = `<p>Your request is being sent via WhatsApp. Please confirm the message.</p>`;
                            appointmentConfirmationMessage.classList.remove('hidden');
                            appointmentForm.reset();
                        }
                    } catch (e) {
                        console.error("Error adding document: ", e);
                        appointmentConfirmationMessage.innerHTML = `<p class="text-red-600">Error booking appointment. Please try again.</p>`;
                        appointmentConfirmationMessage.classList.remove('hidden');
                    }
                });
            }

            // Function to render feedback from Firestore
            const setupFeedbackListener = () => {
                if (!db || !userId || !feedbackDisplayArea) {
                    console.warn("Firestore, User ID, or Feedback Display Area not ready for feedback listener.");
                    return;
                }
                const feedbackColRef = collection(db, `artifacts/${appId}/public/data/feedback`);
                const q = query(feedbackColRef, orderBy("timestamp", "desc")); // Order by timestamp to show latest first

                onSnapshot(q, (snapshot) => {
                    submittedFeedback = []; // Clear existing data
                    snapshot.forEach((doc) => {
                        submittedFeedback.push(doc.data());
                    });
                    renderFeedback(); // Re-render with new data
                }, (error) => {
                    console.error("Error listening to feedback:", error);
                    feedbackDisplayArea.innerHTML = '<p class="text-center text-red-500">Error loading feedback.</p>';
                });
            };

            // Function to render feedback (remains largely the same, but now uses live data)
            const renderFeedback = () => {
                if (!feedbackDisplayArea) return;
                feedbackDisplayArea.innerHTML = ''; // Clear previous feedback

                if (submittedFeedback.length === 0) {
                    feedbackDisplayArea.innerHTML = '<p class="text-center text-gray-500">No feedback submitted yet. Be the first!</p>';
                    return;
                }

                submittedFeedback.forEach(feedback => {
                    const feedbackCard = document.createElement('div');
                    feedbackCard.className = 'bg-white p-6 rounded-lg shadow-md';
                    feedbackCard.innerHTML = `
                        <div class="flex items-center mb-2">
                            <span class="text-amber-500 text-xl mr-2">${'⭐'.repeat(feedback.rating)}</span>
                            <h3 class="font-semibold text-gray-800">${feedback.name}</h3>
                        </div>
                        <p class="text-gray-700 text-sm">${feedback.message}</p>
                    `;
                    feedbackDisplayArea.appendChild(feedbackCard);
                });
            };

            // Feedback Form Submission (updated to use Firestore)
            if (feedbackForm) {
                feedbackForm.addEventListener('submit', async (event) => { // Made async for Firestore
                    event.preventDefault();
                    
                    // Hide any previous success message
                    feedbackSuccessMessage.classList.add('hidden');

                    const patientName = document.getElementById('patient-name').value;
                    const rating = ratingValueInput.value;
                    const message = document.getElementById('feedback-message').value;

                    if (!rating) {
                         ratingError.classList.remove('hidden');
                         return;
                    }

                    try {
                        if (db && userId) {
                            const feedbackData = {
                                name: patientName,
                                rating: parseInt(rating),
                                message: message,
                                timestamp: new Date() // Add a timestamp
                            };
                            const feedbackColRef = collection(db, `artifacts/${appId}/public/data/feedback`);
                            await addDoc(feedbackColRef, feedbackData);
                            console.log("Feedback saved to Firestore:", feedbackData);

                            // Firebase listener will automatically re-render, so just show success message
                            feedbackSuccessMessage.classList.remove('hidden');
                            feedbackForm.reset();
                            // Reset stars
                            starRatingContainer.querySelectorAll('.star').forEach(s => s.classList.remove('selected'));
                            ratingValueInput.value = '';

                            setTimeout(() => {
                                feedbackSuccessMessage.classList.add('hidden');
                            }, 5000); // Hide message after 5 seconds
                        } else {
                            console.warn("Firebase or User ID not available. Cannot save feedback to Firestore.");
                            feedbackSuccessMessage.innerHTML = `<p class="text-red-600">Error submitting feedback. Firebase not connected.</p>`;
                            feedbackSuccessMessage.classList.remove('hidden');
                        }
                    } catch (e) {
                        console.error("Error adding feedback: ", e);
                        feedbackSuccessMessage.innerHTML = `<p class="text-red-600">Error submitting feedback. Please try again.</p>`;
                        feedbackSuccessMessage.classList.remove('hidden');
                    }
                });
            }

            // Search
            if(searchButton) searchButton.addEventListener('click', performSearch);
            if(searchInput) searchInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    performSearch();
                }
            });

            // Search Modal
            if(searchModalClose) searchModalClose.addEventListener('click', hideModal);
            if(searchModal) searchModal.addEventListener('click', (event) => { // Close on backdrop click
                if (event.target === searchModal) {
                    hideModal();
                }
            });

            // Chatbot functionality
            if (chatbotToggle && chatbotPopup && chatbotClose && chatbotMessages && chatbotInput && chatbotSend) {
                let chatHistory = []; // Internal history for LLM
                let totalUserMessages = 0; // Counter for user messages in the current session
                let chatInitialized = false; // Flag to check if initial welcome has been shown

                // Options that are presented as clickable links in the chatbot
                const initialClickableOptions = `
                    <p class="mt-2">You can ask me about:</p>
                    <ul class="list-disc list-inside space-y-1 mt-1">
                        <li><a href="#appointment-section" class="text-blue-600 hover:underline" onclick="
                            document.getElementById('chatbot-popup').classList.remove('show');
                            document.getElementById('appointment-section').scrollIntoView({behavior: 'smooth', block: 'start'});
                            return false;">Book an Appointment</a></li>
                        <li><a href="#doctors" class="text-blue-600 hover:underline" onclick="
                            document.getElementById('chatbot-popup').classList.remove('show');
                            document.getElementById('doctors').scrollIntoView({behavior: 'smooth', block: 'start'});
                            return false;">Doctors List</a></li>
                        <li><a href="#emergency-details" class="text-blue-600 hover:underline" onclick="
                            document.getElementById('chatbot-popup').classList.remove('show');
                            document.getElementById('emergency-details').scrollIntoView({behavior: 'smooth', block: 'start'});
                            return false;">Emergency Services</a></li>
                        <li><a href="#emergency-details" class="text-blue-600 hover:underline" onclick="
                            document.getElementById('chatbot-popup').classList.remove('show');
                            document.getElementById('emergency-details').scrollIntoView({behavior: 'smooth', block: 'start'});
                            return false;">ICU Facility</a></li>
                        <li><a href="tel:+919939396778" class="text-blue-600 hover:underline">Call Reception</a></li>
                        <li><a href="https://wa.me/919939396778" target="_blank" class="text-blue-600 hover:underline">WhatsApp</a></li>
                    </ul>
                `;

                // Keyword to target ID mapping for direct responses
                const keywordLinks = {
                    "booking": { text: "Book an Appointment", targetId: "appointment-section" },
                    "appointment": { text: "Book an Appointment", targetId: "appointment-section" },
                    "doctors": { text: "Our Esteemed Doctors", targetId: "doctors" },
                    "doctor": { text: "Our Esteemed Doctors", targetId: "doctors" },
                    "services": { text: "Our Core Services", targetId: "services" },
                    "service": { text: "Our Core Services", targetId: "services" },
                    "emergency": { text: "24/7 Emergency Care", targetId: "emergency-details" },
                    "icu": { text: "Advanced ICU & NICU", targetId: "emergency-details" }, // Assuming ICU is part of emergency details
                    "call": { text: "Call Reception", action: "tel:+919939396778" },
                    "whatsapp": { text: "Chat on WhatsApp", action: "https://wa.me/919939396778" }
                };

                // Function to add message to chat display
                const addMessage = (sender, message, isHtml = false) => {
                    const messageElement = document.createElement('div');
                    messageElement.className = sender === 'user' ? 'user-message' : 'bot-message';
                    if (isHtml) {
                        messageElement.innerHTML = message;
                    } else {
                        messageElement.textContent = message;
                    }
                    chatbotMessages.appendChild(messageElement);
                    chatbotMessages.scrollTop = chatbotMessages.scrollHeight; // Auto-scroll to bottom
                };

                // Function to display the initial welcome and options
                const displayInitialWelcome = () => {
                    addMessage('bot', "Hi, Welcome to Guru Dayal Singh Hospital! How can I assist you today?", false);
                    addMessage('bot', initialClickableOptions, true);
                    chatHistory = [{ role: "model", parts: [{ text: "Initial greeting and options from hospital assistant." }] }];
                    chatInitialized = true;
                };

                // Function to send message to LLM (modified)
                const sendMessageToLLM = async (message) => {
                    
                    // Logic to clear chat after every 2 messages (i.e., on the 3rd, 5th, 7th... message)
                    if (totalUserMessages % 2 === 0 && totalUserMessages > 0) { // Clear on 2nd, 4th, etc., so the next user message is the "first" of a new segment
                        chatbotMessages.innerHTML = ''; // Clear display
                        addMessage('bot', "Continuing our conversation. How else can I help?", false); // Shorter restart message
                        chatHistory = []; // Reset LLM history
                        chatHistory.push({ role: "model", parts: [{ text: "Chat session restarted due to message limit." }] });
                        // Re-add the current user message and add to history
                        addMessage('user', message);
                        chatHistory.push({ role: "user", parts: [{ text: message }] });
                    } else {
                        addMessage('user', message); // Display user message immediately
                        // Add user message to chat history for LLM
                        chatHistory.push({ role: "user", parts: [{ text: message }] });
                    }
                    chatbotInput.value = ''; // Clear input immediately
                    totalUserMessages++; // Increment user message counter
                    
                    const lowerCaseMessage = message.toLowerCase().trim();
                    let handledLocally = false;

                    // Handle specific predefined conversational responses
                    if (lowerCaseMessage.includes("how are you")) {
                        addMessage('bot', "Hi, I am fine, thank you! How are you today.");
                        chatHistory.push({ role: "model", parts: [{ text: "Bot responded 'I am fine, thank you! How are you today?'" }] });
                        handledLocally = true;
                    } else if (lowerCaseMessage.includes("i am good") || lowerCaseMessage.includes("i'm good")) {
                        addMessage('bot', "Glad to know that.");
                        chatHistory.push({ role: "model", parts: [{ text: "Bot responded 'Glad to know that.'" }] });
                        handledLocally = true;
                    } else {
                        // Check for keywords and provide clickable links
                        for (const keyword in keywordLinks) {
                            if (lowerCaseMessage.includes(keyword)) {
                                const { text, targetId, action } = keywordLinks[keyword];
                                let linkHtml;
                                if (action) {
                                    linkHtml = `You can <a href="${action}" target="_blank" class="text-blue-600 hover:underline">${text}</a>.`;
                                } else {
                                    linkHtml = `Here is information about <a href="#${targetId}" class="text-blue-600 hover:underline" onclick="
                                        document.getElementById('chatbot-popup').classList.remove('show');
                                        document.getElementById('${targetId}').scrollIntoView({behavior: 'smooth', block: 'start'});
                                        return false;">${text}</a>.`;
                                }
                                addMessage('bot', linkHtml, true); // Display bot's local response as HTML
                                
                                // Add local bot response to history for LLM context, but indicate it was local
                                chatHistory.push({ role: "model", parts: [{ text: `[System]: Handled user query about '${keyword}' locally by providing a link/action to '${targetId || action}'.` }] });
                                
                                handledLocally = true;
                                break; // Stop after the first keyword match
                            }
                        }
                    }

                    if (handledLocally) {
                        return; // Exit if handled locally (no LLM call needed)
                    }

                    // If not handled locally, proceed with LLM call
                    try {
                        // Show typing indicator
                        const typingIndicator = document.createElement('div');
                        typingIndicator.className = 'bot-message animate-pulse';
                        typingIndicator.textContent = 'Assistant is typing...';
                        chatbotMessages.appendChild(typingIndicator);
                        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;

                        const payload = { contents: chatHistory };
                        const apiKey = ""; // Keep this as-is; Canvas will provide it
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();

                        // Remove typing indicator
                        if (chatbotMessages.contains(typingIndicator)) {
                            chatbotMessages.removeChild(typingIndicator);
                        }

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const botResponse = result.candidates[0].content.parts[0].text;
                            addMessage('bot', botResponse); // Display LLM's response
                            chatHistory.push({ role: "model", parts: [{ text: botResponse }] }); // Add LLM's response to history
                        } else {
                            addMessage('bot', "Sorry, I couldn't get a response from the AI. Please try again.");
                            chatHistory.push({ role: "model", parts: [{ text: "Error: No AI response." }] }); // Add error to history
                        }
                    } catch (error) {
                        console.error("Error calling LLM:", error);
                        if (chatbotMessages.contains(typingIndicator)) {
                            chatbotMessages.removeChild(typingIndicator); // Remove typing indicator on error
                        }
                        addMessage('bot', "There was an error connecting to the assistant. Please try again later.");
                        chatHistory.push({ role: "model", parts: [{ text: `Error: LLM call failed - ${error.message}` }] }); // Add error to history
                    }
                };

                // Chatbot toggle event listener (modified for initial welcome message)
                chatbotToggle.addEventListener('click', () => {
                    chatbotPopup.classList.toggle('show');
                    // If the chatbot is shown and not yet initialized, display the welcome
                    if (chatbotPopup.classList.contains('show') && !chatInitialized) {
                        displayInitialWelcome();
                    }
                });

                chatbotClose.addEventListener('click', () => {
                    chatbotPopup.classList.remove('show');
                });

                // Clear all chat history and reset state when mouse leaves the AI icon
                chatbotToggle.addEventListener('mouseleave', () => {
                    // A small delay before hiding, allows re-entry without flicker
                    const timeoutId = setTimeout(() => {
                        chatbotPopup.classList.remove('show');
                        chatbotMessages.innerHTML = ''; // Clear display
                        chatHistory = []; // Clear internal history
                        totalUserMessages = 0; // Reset user message count
                        chatInitialized = false; // Reset initialization flag
                    }, 300); // Adjust delay as needed
                    chatbotPopup.dataset.timeoutId = timeoutId; // Store timeout ID
                });
                
                // If mouse enters the chatbot button, show popup
                chatbotToggle.addEventListener('mouseenter', () => {
                    clearTimeout(chatbotPopup.dataset.timeoutId); // Clear any pending close timeout
                    chatbotPopup.classList.add('show');
                    if (!chatInitialized) { // Display welcome if not already
                        displayInitialWelcome();
                    }
                });
                
                // Prevent popup from closing if mouse enters popup from button
                chatbotPopup.addEventListener('mouseenter', () => {
                    clearTimeout(chatbotPopup.dataset.timeoutId); // Clear any pending close timeout
                });


                chatbotSend.addEventListener('click', () => {
                    const message = chatbotInput.value.trim();
                    if (message) {
                        sendMessageToLLM(message);
                    }
                });

                chatbotInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const message = chatbotInput.value.trim();
                        if (message) {
                            sendMessageToLLM(message);
                        }
                    }
                });
            }

            // --- Model of Care Diagram Logic ---
            const nodesContent = [
                { text: "Exceptional clinical talent", id: "clinical-talent-details" },
                { text: "World-class infrastructure", id: "infrastructure-details" },
                { text: "Latest high-end technology", id: "technology-details" },
                { text: "Caring systems and processes", id: "systems-processes-details" },
                { text: "Trust-based compassionate care", id: "compassionate-care-details" }
            ];

            const diagramWrapperNew = document.querySelector('.diagram-wrapper-new');
            const nodesContainerNew = document.querySelector('.nodes-container-new');
            const centerImageDivNew = document.querySelector('.center-image-new');
            const svgElementNew = document.querySelector('.diagram-lines-new');
            const modelCareHeadingDesktop = document.querySelector('.model-care-heading-desktop');


            // Only run if desktop diagram elements exist
            if (diagramWrapperNew && nodesContainerNew && centerImageDivNew && svgElementNew) {
                // Set SVG dimensions to match diagram-wrapper-new
                // Use ResizeObserver for responsive sizing
                const resizeObserver = new ResizeObserver(entries => {
                    for (let entry of entries) {
                        if (entry.target === diagramWrapperNew) {
                            // The inner div handles the true dimensions
                            const innerDiv = entry.target.querySelector('.diagram-wrapper-new-inner');
                            if (innerDiv) {
                                svgElementNew.setAttribute("width", innerDiv.offsetWidth);
                                svgElementNew.setAttribute("height", innerDiv.offsetHeight);
                                positionNodesAndDrawLines();
                            }
                        }
                    }
                });
                resizeObserver.observe(diagramWrapperNew);

                // Initial positioning
                const positionNodesAndDrawLines = () => {
                    if (!nodesContainerNew || !centerImageDivNew || !svgElementNew) return; // Defensive check

                    nodesContainerNew.innerHTML = ''; // Clear existing nodes
                    svgElementNew.innerHTML = ''; // Clear existing lines

                    const wrapperWidth = diagramWrapperNew.offsetWidth;
                    const wrapperHeight = diagramWrapperNew.offsetHeight;
                    const centerImageWidth = centerImageDivNew.offsetWidth; // Get current rendered width
                    const centerImageRadius = centerImageWidth / 2;

                    const diagramCenterX = wrapperWidth / 2;
                    const diagramCenterY = wrapperHeight / 2;

                    // Temporarily create a dummy node to measure its dimensions
                    const dummyNode = document.createElement('div');
                    dummyNode.className = 'node-new'; // Apply the same classes for measurement
                    dummyNode.style.visibility = 'hidden';
                    dummyNode.style.position = 'absolute'; // Needed for accurate measurement
                    nodesContainerNew.appendChild(dummyNode);
                    const nodeWidth = dummyNode.offsetWidth; // This will now reflect the 'em' based width in pixels
                    const nodeRadius = nodeWidth / 2;
                    nodesContainerNew.removeChild(dummyNode);

                    // Calculate the orbital radius for positioning the nodes
                    // Adjusted for better spacing and to consider wrapper's min dimension
                    const maxOrbitalRadius = Math.min(wrapperWidth, wrapperHeight) / 2 - nodeRadius - 10;
                    const actualOrbitalRadius = Math.max(maxOrbitalRadius, centerImageRadius + nodeRadius + 10); // Reduced padding from 30 to 10
                    
                    nodesContent.forEach((content, index) => {
                        // Calculate angle for each node, adjusting for 5 nodes for equal spacing
                        const angle = (2 * Math.PI / nodesContent.length) * index - (Math.PI / 2);

                        const x = diagramCenterX + actualOrbitalRadius * Math.cos(angle);
                        const y = diagramCenterY + actualOrbitalRadius * Math.sin(angle);

                        const node = document.createElement('div');
                        node.className = 'node-new';
                        node.innerHTML = `<p><strong>${content.text}</strong></p><a href="#${content.id}" class="know-more-new service-link" data-back-to-scroll="true">Know More <span class="arrow-new">&#10140;</span></a>`; // Added data-back-to-scroll
                        node.style.left = `${x}px`;
                        node.style.top = `${y}px`;
                        node.style.transform = `translate(-50%, -50%)`;
                        nodesContainerNew.appendChild(node);

                        // Create and append the dotted line using SVG
                        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                        line.setAttribute("x1", x);
                        line.setAttribute("y1", y);
                        line.setAttribute("x2", diagramCenterX);
                        line.setAttribute("y2", diagramCenterY);
                        line.setAttribute("stroke", "gray");
                        line.setAttribute("stroke-dasharray", "5,5");
                        line.setAttribute("stroke-width", "1");
                        svgElementNew.appendChild(line);
                    });

                    // Position the main heading relative to the top node or center
                    if (modelCareHeadingDesktop) {
                        const topNode = nodesContainerNew.querySelector('.node-new');
                        if (topNode) {
                            const topNodeRect = topNode.getBoundingClientRect();
                            const diagramInnerRect = diagramWrapperNew.querySelector('.diagram-wrapper-new-inner').getBoundingClientRect();
                            
                            // Increased offset to 40px for more gap
                            const relativeTop = (topNodeRect.top - diagramInnerRect.top) - (modelCareHeadingDesktop.offsetHeight / 2) - 40; 
                            
                            modelCareHeadingDesktop.style.top = `${relativeTop}px`;
                        } else {
                            modelCareHeadingDesktop.style.top = `-4em`; // Fallback in em
                        }
                    }
                };

                // Call initially
                positionNodesAndDrawLines();
                // Initial render of feedback (empty at first)
                renderFeedback();
            }

        });
    </script>

</body>
</html>
